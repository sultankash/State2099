<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2099 STATE PORTAL | COMMAND HQ</title>
    <!-- Fonts & Icons -->
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            --neon: #00d4ff; --gold: #ffba08; --bg: #030b16; 
            --glass: rgba(13, 35, 67, 0.85); --red: #ff3e3e; --green: #00ff88;
        }

        body {
            margin: 0; padding: 0; font-family: 'Orbitron', sans-serif;
            background: var(--bg) url('https://whiteoutsurvival.wiki/wp-content/uploads/2023/04/Whiteout-Survival-Wallpaper-1.jpg') no-repeat center center fixed;
            background-size: cover; color: white; min-height: 100vh;
        }

        .blur-overlay { position: fixed; inset: 0; backdrop-filter: blur(18px); background: rgba(3, 11, 22, 0.75); z-index: -1; }

        /* --- Custom Language HUD --- */
        .lang-container { position: fixed; top: 20px; left: 20px; z-index: 1500; }
        .lang-trigger { background: rgba(0,0,0,0.7); border: 1.5px solid var(--neon); border-radius: 50px; padding: 8px 15px; display: flex; align-items: center; gap: 10px; cursor: pointer; transition: 0.3s; }
        .lang-trigger:hover { box-shadow: 0 0 15px var(--neon); }
        .lang-trigger img { width: 22px; border-radius: 2px; }
        .lang-dropdown { display: none; position: absolute; top: 110%; left: 0; background: rgba(3, 11, 22, 0.95); border: 1px solid var(--neon); border-radius: 12px; padding: 5px; width: 180px; backdrop-filter: blur(10px); }
        .lang-container:hover .lang-dropdown { display: block; }
        .lang-item { display: flex; align-items: center; gap: 12px; padding: 10px; cursor: pointer; border-radius: 8px; font-size: 0.75rem; }
        .lang-item:hover { background: rgba(0, 212, 255, 0.2); }
        .lang-item img { width: 20px; }

        /* --- Side Dock Tools --- */
        .side-dock { position: fixed; right: 10px; top: 50%; transform: translateY(-50%); display: flex; flex-direction: column; gap: 8px; z-index: 1000; }
        .dock-item { width: 60px; height: 60px; background: rgba(3, 11, 22, 0.9); border: 1.5px solid var(--neon); border-radius: 10px; display: flex; flex-direction: column; align-items: center; justify-content: center; text-decoration: none; color: white; transition: 0.3s; box-shadow: 0 0 10px rgba(0,212,255,0.2); }
        .dock-item:hover { background: var(--neon); color: black; box-shadow: 0 0 20px var(--neon); transform: scale(1.05); }
        .dock-item i { font-size: 1.3rem; margin-bottom: 2px; }
        .dock-item span { font-size: 0.45rem; font-weight: 900; text-align: center; line-height: 1; }

        /* --- Stats Bar --- */
        .stats-grid { display: flex; justify-content: center; gap: 15px; max-width: 1100px; margin: 20px auto 0; padding: 10px; flex-wrap: wrap; }
        .stat-card { background: var(--glass); border: 1px solid rgba(255,255,255,0.1); border-radius: 12px; padding: 12px 25px; text-align: center; min-width: 160px; box-shadow: 0 5px 20px rgba(0,0,0,0.4); }
        .stat-card small { display: block; font-size: 0.6rem; color: #888; margin-bottom: 4px; }
        .stat-card span { font-size: 1rem; color: var(--gold); font-weight: 900; }

        header { text-align: center; margin-bottom: 5px; }
        header h1 { font-size: 4rem; margin: 0; letter-spacing: 15px; text-shadow: 0 0 20px var(--neon); }
        header p { color: var(--gold); letter-spacing: 5px; font-size: 0.8rem; margin-top: -10px; font-weight: 900; }

        /* --- Announcement --- */
        .ann-wrap { max-width: 750px; margin: 15px auto 30px; position: relative; padding: 0 20px; }
        .ann-tag { position: absolute; top: -10px; left: 40px; background: var(--gold); color: black; font-size: 0.6rem; padding: 2px 12px; font-weight: 900; border-radius: 4px; }
        .ann-body { background: rgba(0, 212, 255, 0.05); border: 1.5px solid var(--neon); border-radius: 12px; padding: 18px; text-align: center; font-family: 'Cairo'; font-size: 1rem; }

        /* --- Main Cards --- */
        .cards-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 25px; max-width: 1000px; margin: 0 auto; padding: 0 20px; }
        .p-card { background: var(--glass); border: 2.5px solid rgba(255,255,255,0.05); border-radius: 25px; padding: 70px 20px; text-align: center; cursor: pointer; transition: 0.4s; position: relative; overflow: hidden; }
        .p-card:hover { border-color: var(--neon); transform: translateY(-8px); background: rgba(0, 212, 255, 0.1); }
        .p-card i { font-size: 4rem; color: var(--neon); margin-bottom: 20px; display: block; }
        .p-card h2 { margin: 0; font-size: 2rem; letter-spacing: 4px; }
        .p-card small { font-family: 'Cairo'; opacity: 0.5; font-size: 0.85rem; display: block; margin-top: 5px; }

        .locked-overlay { position: absolute; inset: 0; background: rgba(0,0,0,0.92); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 20; color: var(--red); display: none; }
        .locked-overlay i { font-size: 3rem; margin-bottom: 10px; }

        /* --- Scrollable Forms (THE HUD) --- */
        .form-view { display: none; position: fixed; inset: 0; background: var(--bg); z-index: 2000; overflow-y: auto; padding: 60px 20px; }
        .form-hud { width: 100%; max-width: 550px; background: rgba(13, 35, 67, 0.4); border: 2px solid var(--neon); padding: 50px; border-radius: 25px; margin: auto; position: relative; backdrop-filter: blur(10px); box-shadow: 0 0 50px rgba(0,212,255,0.2); }
        .btn-back-top { position: absolute; top: 20px; left: 20px; background: white; color: black; border: none; padding: 6px 20px; border-radius: 50px; font-family: 'Orbitron'; font-weight: 900; cursor: pointer; text-transform: uppercase; font-size: 0.7rem; }

        .field { margin-bottom: 25px; text-align: left; }
        .field label { display: block; font-size: 0.7rem; color: var(--neon); margin-bottom: 8px; font-weight: 900; letter-spacing: 1px; text-transform: uppercase; }
        input, select { width: 100%; padding: 14px; background: #000; border: 1.5px solid #1a3a5a; color: white; font-family: 'Orbitron'; box-sizing: border-box; font-size: 1rem; border-radius: 8px; }
        
        .btn-transmit { width: 100%; padding: 20px; background: white; color: black; border: none; font-family: 'Orbitron'; font-weight: 900; cursor: pointer; border-radius: 12px; margin-top: 20px; font-size: 1.1rem; text-transform: uppercase; letter-spacing: 2px; transition: 0.3s; }
        .btn-transmit:hover { background: var(--neon); transform: translateY(-3px); }

        /* --- Admin HQ --- */
        #admin-hq { display: none; position: fixed; inset: 0; background: #000; z-index: 3000; padding: 30px; overflow-y: auto; }
        .admin-wrap { max-width: 1000px; margin: 0 auto; background: #080808; border: 1px solid #222; border-radius: 15px; padding: 45px; }
        .admin-header { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #333; padding-bottom: 20px; margin-bottom: 30px; }
        .admin-row { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; margin-bottom: 20px; }
        .status-btn { padding: 18px; border: none; font-weight: 900; cursor: pointer; border-radius: 8px; font-size: 0.9rem; }
        .open { background: var(--green); color: black; }
        .locked { background: var(--red); color: white; }
        .dl-btn { background: var(--green); color: black; padding: 18px; text-align: center; text-decoration: none; font-weight: 900; border-radius: 8px; display: block; margin-top: 10px; }

        .success-box { display: none; text-align: center; }
        .success-box i { font-size: 5rem; color: var(--green); margin-bottom: 20px; }
    </style>
</head>
<body>

<div class="blur-overlay"></div>

<!-- Language Tool -->
<div class="lang-container">
    <div class="lang-trigger">
        <i class="fas fa-globe"></i>
        <img src="https://flagcdn.com/w40/sa.png" id="active-flag">
        <span>EN / AR</span>
    </div>
    <div class="lang-dropdown">
        <div class="lang-item" onclick="setLang('ar','sa')"><img src="https://flagcdn.com/w40/sa.png"> العربية</div>
        <div class="lang-item" onclick="setLang('en','us')"><img src="https://flagcdn.com/w40/us.png"> English</div>
        <div class="lang-item" onclick="setLang('ru','kz')"><img src="https://flagcdn.com/w40/kz.png"> Русский</div>
        <div class="lang-item" onclick="setLang('ko','kr')"><img src="https://flagcdn.com/w40/kr.png"> 한국어</div>
        <div class="lang-item" onclick="setLang('id','id')"><img src="https://flagcdn.com/w40/id.png"> Indonesia</div>
    </div>
</div>

<!-- Tools HUD -->
<div class="side-dock">
    <div class="dock-item" onclick="showBT()"><i class="fas fa-paw"></i><span>BT TIMINGS</span></div>
    <a href="https://wos-giftcode.centurygame.com/" target="_blank" class="dock-item"><i class="fas fa-gift"></i><span>REDEEM</span></a>
    <a href="https://whiteoutsurvival.pl/chief-gear-calculator/" target="_blank" class="dock-item"><i class="fas fa-shield-halved"></i><span>GEAR CALC</span></a>
    <a href="https://www.quackulator.com/chiefcharm.php" target="_blank" class="dock-item"><i class="fas fa-book"></i><span>CHARM CALC</span></a>
    <a href="https://sim.tundra.land/" target="_blank" class="dock-item"><i class="fas fa-bolt"></i><span>BATTLE SIM</span></a>
</div>

<!-- Portal UI -->
<div id="player-portal">
    <div class="stats-grid">
        <div class="stat-card"><small>CURRENT PRESIDENT</small><span id="v-pres">LOADING...</span></div>
        <div class="stat-card"><small>LEAGUES TITLES</small><span id="v-league">...</span></div>
        <div class="stat-card"><small>SVS VICTORIES</small><span id="v-svs">...</span></div>
        <div class="stat-card"><small>PLAYER OF MONTH</small><span id="v-pom">...</span></div>
    </div>

    <header><h1>2099</h1><p>STATE PORTAL</p></header>

    <div class="ann-wrap">
        <div class="ann-tag">STATE'S ANNOUNCEMENTS</div>
        <div class="ann-body" id="v-ann">Establishing HQ Link...</div>
    </div>

    <div class="cards-grid">
        <div class="p-card" onclick="openProtocol('svs')">
            <i class="fas fa-chess-rook"></i><h2>MINISTRY</h2><small>طلبات الوزارات</small>
            <div id="lock-svs-ui" class="locked-overlay"><i class="fas fa-lock"></i><span>SECTION CLOSED</span></div>
        </div>
        <div class="p-card" onclick="openProtocol('tyrant')">
            <i class="fas fa-skull-crossbones"></i><h2>TYRANT</h2><small>حرب الطاغية</small>
            <div id="lock-tyrant-ui" class="locked-overlay"><i class="fas fa-lock"></i><span>SECTION CLOSED</span></div>
        </div>
        <div class="p-card" onclick="openProtocol('transfers')">
            <i class="fas fa-plane-arrival"></i><h2>TRANSFER</h2><small>طلبات الانتقال</small>
            <div id="lock-transfers-ui" class="locked-overlay"><i class="fas fa-lock"></i><span>SECTION CLOSED</span></div>
        </div>
    </div>
</div>

<!-- Form Modal -->
<div id="form-view" class="form-view">
    <div class="form-hud">
        <button class="btn-back-top" onclick="closeProtocol()">BACK</button>
        <div id="form-container">
            <h2 id="f-title" style="text-align:center; color:white; letter-spacing:4px; margin-top:20px;">PROTOCOL</h2>
            <div id="f-inputs"></div>
            <button class="btn-transmit" id="sub-btn" onclick="submitMission()">TRANSMIT</button>
        </div>
        <div id="success-view" class="success-box">
            <i class="fas fa-check-double"></i>
            <h2 style="letter-spacing:5px;">MISSION SECURED</h2>
            <button class="btn-transmit" onclick="closeProtocol()">RETURN TO PORTAL</button>
        </div>
    </div>
</div>

<!-- Admin HQ -->
<div id="admin-hq">
    <div class="admin-wrap">
        <div class="admin-header">
            <h1 style="color:var(--neon); margin:0;">ADMIN HQ</h1>
            <button class="status-btn locked" onclick="exitAdmin()">EXIT</button>
        </div>
        <div class="field"><label>PRESIDENT:</label><input type="text" id="adm-pres"></div>
        <div class="admin-row">
            <div class="field"><label>PLAYER OF MONTH:</label><input type="text" id="adm-pom"></div>
            <div class="field"><label>LEAGUES TITLES:</label><input type="text" id="adm-league"></div>
            <div class="field"><label>SVS WINS:</label><input type="text" id="adm-svs"></div>
        </div>
        <div class="field"><label>ANNOUNCEMENT:</label><textarea id="adm-ann" rows="3" style="width:100%; background:#000; color:white; border:1px solid #333; padding:15px; font-family:'Cairo'; font-size:1.1rem;"></textarea></div>

        <h3 style="color:var(--neon); border-bottom:1px solid #333; margin-top:40px;">BT TIMINGS</h3>
        <div id="adm-bt-grid"></div>

        <h3 style="color:var(--neon); border-bottom:1px solid #333; margin-top:40px;">SYSTEM LOCKS</h3>
        <div class="admin-row">
            <button id="pb-svs" class="status-btn" onclick="toggleLock('svs_lock')">SVS</button>
            <button id="pb-tyrant" class="status-btn" onclick="toggleLock('tyrant_lock')">TYRANT</button>
            <button id="pb-transfers" class="status-btn" onclick="toggleLock('transfers_lock')">TRANSFERS</button>
        </div>

        <h3 style="color:var(--neon); border-bottom:1px solid #333; margin-top:40px;">DATA EXPORTS (EXCEL)</h3>
        <div class="admin-row">
            <a href="#" id="dl-svs" class="dl-btn">DOWNLOAD SVS</a>
            <a href="#" id="dl-tyrant" class="dl-btn">DOWNLOAD TYRANT</a>
            <a href="#" id="dl-trans" class="dl-btn">DOWNLOAD TRANSFERS</a>
        </div>
        <button class="btn-transmit" style="background:var(--neon); margin-top:40px;" onclick="saveHQ()">SAVE DASHBOARD</button>
    </div>
</div>

<div style="text-align:center; padding:30px; opacity:0.01;"><button onclick="loginAdmin()">HQ_OVERRIDE</button></div>

<script>
    const API = "https://script.google.com/macros/s/AKfycbwYnknz6OOm1CNpocLueTMXMSrBdkqH6bDb5OKlGfPGi-cLD20ZdN-taIahdSvefiA/exec";
    const SHEET_ID = "1LkFhOMltulOB-gTkBP1G99bGlzwTt-_nxCu68gR-wwU";
    let hqData = {};
    let activeType = "";

    window.onload = loadData;

    function loadData() {
        fetch(API).then(r => r.json()).then(data => {
            hqData = data;
            syncUI();
        });
    }

    function syncUI() {
        const s = hqData.settings;
        document.getElementById('v-pres').innerText = s.president || '---';
        document.getElementById('v-league').innerText = s.league_wins || '---';
        document.getElementById('v-svs').innerText = s.svs_wins || '---';
        document.getElementById('v-pom').innerText = s.player_of_the_month || s.hero_of_the_month || '---';
        document.getElementById('v-ann').innerText = s.announcement || 'No communications.';

        // Locks logic
        document.getElementById('lock-svs-ui').style.display = (s.svs_lock === "TRUE") ? "flex" : "none";
        document.getElementById('lock-tyrant-ui').style.display = (s.tyrant_lock === "TRUE") ? "flex" : "none";
        document.getElementById('lock-transfers-ui').style.display = (s.transfers_lock === "TRUE") ? "flex" : "none";

        // Admin Fields
        document.getElementById('adm-pres').value = s.president || '';
        document.getElementById('adm-pom').value = s.player_of_the_month || '';
        document.getElementById('adm-league').value = s.league_wins || '';
        document.getElementById('adm-svs').value = s.svs_wins || '';
        document.getElementById('adm-ann').value = s.announcement || '';

        const btG = document.getElementById('adm-bt-grid');
        btG.innerHTML = "";
        hqData.bt.forEach((b, i) => {
            btG.innerHTML += `<div class="admin-row"><input type="text" id="at-n-${i}" value="${b.alliance}"><input type="text" id="at-1-${i}" value="${b.bt1}"><input type="text" id="at-2-${i}" value="${b.bt2}"></div>`;
        });

        updateLockBtn('pb-svs', s.svs_lock);
        updateLockBtn('pb-tyrant', s.tyrant_lock);
        updateLockBtn('pb-transfers', s.transfers_lock);

        // Download Links (Excel XLSX Format)
        const base = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/export?format=xlsx`;
        document.getElementById('dl-svs').href = base + `&gid=1767999200`;
        document.getElementById('dl-tyrant').href = base + `&gid=1142906535`;
        document.getElementById('dl-trans').href = base + `&gid=914028515`;
    }

    function updateLockBtn(id, val) {
        const el = document.getElementById(id);
        el.innerText = (val === "TRUE") ? "LOCKED" : "OPEN";
        el.className = "status-btn " + (val === "TRUE" ? "locked" : "open");
    }

    function openProtocol(type) {
        if(hqData.settings[type + "_lock"] === "TRUE") return;
        activeType = type;
        document.getElementById('player-portal').style.display = 'none';
        document.getElementById('form-view').style.display = 'block';
        document.getElementById('form-container').style.display = 'block';
        document.getElementById('success-view').style.display = 'none';
        document.getElementById('f-title').innerText = type.toUpperCase() + " PROTOCOL";
        
        const ins = document.getElementById('f-inputs');
        ins.innerHTML = "";

        if(type === 'svs') {
            ins.innerHTML = `<div class="field"><label>NAME</label><input type="text" id="sv-n"></div><div class="field"><label>ALLIANCE</label><input type="text" id="sv-a"></div><div class="field"><label>GAME ID</label><input type="text" id="sv-i"></div><div class="field"><label>MINISTRY</label><select id="sv-m"><option>Vice President</option><option>Ministry of Education</option></select></div><div class="field"><label>SPEEDUPS</label><select id="sv-s"><option>40 Days or less</option><option>Above 40 Days</option><option>Above 100 Days</option></select></div><div class="field"><label>TIMING (UTC)</label><select id="sv-t">${getTimes()}</select></div>`;
        } else if(type === 'transfers') {
            ins.innerHTML = `<div class="field"><label>NAME</label><input type="text" id="tr-n"></div><div class="field"><label>CURRENT STATE</label><input type="text" id="tr-s"></div><div class="field"><label>FC LEVEL</label><select id="tr-f"><option>FC7</option><option>FC8</option><option>FC9</option><option>FC10</option></select></div><div class="field"><label>HELIOS TROOPS?</label><select id="tr-h"><option>Yes</option><option>No</option></select></div><div class="field"><label>CURRENT POWER</label><input type="text" id="tr-p"></div><div class="field"><label>MONTH OF JOINING</label><select id="tr-m">${getMonths()}</select></div><div class="field"><label>AWARE OF REDUCTION?</label><select id="tr-a"><option>Yes</option><option>No</option></select></div>`;
        } else if(type === 'tyrant') {
            ins.innerHTML = `<div class="field"><label>NAME</label><input type="text" id="ty-n"></div><div class="field"><label>ALLIANCE</label><input type="text" id="ty-a"></div><div class="field"><label>AVAILABLE 5H?</label><select id="ty-5"><option>Yes</option><option>No</option></select></div><div class="field"><label>DISCORD (MANDATORY)?</label><select id="ty-d"><option>Yes</option><option>No</option></select></div><div class="field"><label>FC LEVEL</label><select id="ty-f"><option>FC8</option><option>FC9</option><option>FC10</option></select></div><div class="field"><label>HELIOS CATEGORY</label><select id="ty-h"><option>1 Category</option><option>2 Categories</option><option>Full Helios</option></select></div>`;
        }
    }

    function getTimes() { let o=""; for(let i=0; i<24; i++){ let h=i<10?'0'+i:i; o+=`<option>${h}:00 UTC</option>`; } return o; }
    function getMonths() { return ["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"].map(m => `<option>${m}</option>`).join(""); }

    function closeProtocol() { document.getElementById('player-portal').style.display='block'; document.getElementById('form-view').style.display='none'; }

    function submitMission() {
        const p = {};
        document.querySelectorAll('#f-inputs input, #f-inputs select').forEach(i => { p[i.previousElementSibling.innerText] = i.value; });
        document.getElementById('sub-btn').innerText = "TRANSMITTING...";
        fetch(API, { method: 'POST', body: JSON.stringify({ type: activeType, payload: p }) }).then(() => {
            document.getElementById('form-container').style.display='none';
            document.getElementById('success-view').style.display='block';
        });
    }

    function showBT() {
        let msg = "BEAR TRAP TIMINGS:\n\n";
        hqData.bt.forEach(b => msg += `${b.alliance}: ${b.bt1} & ${b.bt2}\n`);
        alert(msg);
    }

    function setLang(code, flag) {
        document.getElementById('active-flag').src = `https://flagcdn.com/w40/${flag}.png`;
        alert("Translating interface...");
    }

    function loginAdmin() { if(prompt("HQ CLEARANCE:") === "State2099") document.getElementById('admin-hq').style.display='block'; }
    function exitAdmin() { document.getElementById('admin-hq').style.display='none'; }

    function saveHQ() {
        const s = {
            president: document.getElementById('adm-pres').value,
            player_of_the_month: document.getElementById('adm-pom').value,
            league_wins: document.getElementById('adm-league').value,
            svs_wins: document.getElementById('adm-svs').value,
            announcement: document.getElementById('adm-ann').value,
            svs_lock: hqData.settings.svs_lock, tyrant_lock: hqData.settings.tyrant_lock, transfers_lock: hqData.settings.transfers_lock
        };
        const b = [];
        for(let i=0; i<4; i++) {
            b.push([ document.getElementById(`at-n-${i}`).value, document.getElementById(`at-1-${i}`).value, document.getElementById(`at-2-${i}`).value ]);
        }
        fetch(API, { method: 'POST', body: JSON.stringify({ type: "admin_update", settings: s, bt: b }) }).then(() => location.reload());
    }

    function toggleLock(key) {
        hqData.settings[key] = (hqData.settings[key] === "TRUE") ? "FALSE" : "TRUE";
        saveHQ();
    }
</script>
</body>
</html>
